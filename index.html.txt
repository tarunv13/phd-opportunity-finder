<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interdisciplinary PhD Opportunity Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2d7a7e;
            --primary-hover: #1d5658;
            --accent: #e67e22;
            --text: #1a1a1a;
            --bg-light: #f8f9fa;
            --border: #e0e0e0;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            margin: 0;
            padding: 0;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .header {
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeInDown 0.6s ease;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0 0 0.5rem 0;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .filters-panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            animation: fadeInUp 0.6s ease;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 122, 126, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 400;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }
        
        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 122, 126, 0.3);
        }
        
        .btn-secondary {
            background: var(--accent);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #d35400;
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .results-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            animation: fadeInUp 0.6s ease;
        }
        
        .results-header {
            background: linear-gradient(135deg, var(--primary) 0%, #1d5658 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .results-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .results-count {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .results-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .results-body {
            padding: 2rem;
        }
        
        .opportunity-card {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .opportunity-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .opportunity-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
        }
        
        .opportunity-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .badge-primary {
            background: rgba(45, 122, 126, 0.1);
            color: var(--primary);
        }
        
        .badge-success {
            background: rgba(27, 188, 155, 0.1);
            color: #1bbc9b;
        }
        
        .badge-accent {
            background: rgba(230, 126, 34, 0.1);
            color: var(--accent);
        }
        
        .opportunity-meta {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #666;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .opportunity-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        
        .opportunity-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }
        
        .opportunity-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: gap 0.3s;
        }
        
        .opportunity-link:hover {
            gap: 0.75rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: #999;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-state p {
            margin: 0.5rem 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-header h2 {
            margin: 0;
            color: var(--primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border: 1px solid #f5c6cb;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--primary);
            color: white;
            text-align: center;
            padding: 0.75rem;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            white-space: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .results-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .opportunity-header {
                flex-direction: column;
            }
            
            .opportunity-footer {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                PhD Finder
            </div>
            <div class="nav-links">
                <a href="#features">Features</a>
                <a href="#about">About</a>
                <a href="#github" target="_blank"><i class="fab fa-github"></i> GitHub</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéì Interdisciplinary PhD Opportunity Finder</h1>
            <p>Discover fully-funded PhD positions in behavior change, environmental conservation, gamification, VR, visual media & more. Search across global universities & academic job boards.</p>
        </div>

        <!-- Filters Panel -->
        <div class="filters-panel">
            <h2 style="margin-top: 0; color: var(--primary);">Search Filters</h2>
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="location">Geographic Region</label>
                    <select id="location">
                        <option value="global">üåç Global</option>
                        <option value="europe">üá™üá∫ Europe</option>
                        <option value="north-america">üá∫üá∏ North America</option>
                        <option value="asia">üåè Asia</option>
                        <option value="uk">üá¨üáß UK & Ireland</option>
                        <option value="nordic">üá∏üá™ Nordic Countries</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="funding">Funding Status</label>
                    <select id="funding">
                        <option value="fully-funded">üí∞ Fully Funded</option>
                        <option value="any">Any</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="deadline">Deadline Range (months)</label>
                    <input type="number" id="deadline" min="1" max="24" value="12" placeholder="12">
                </div>
            </div>

            <div class="filter-group" style="margin-bottom: 1.5rem;">
                <label style="font-weight: 600; margin-bottom: 1rem; display: block;">Research Disciplines <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Select one or more disciplines to refine search</span></span></label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="discipline" value="behavior-change" checked> üß† Behavior Change</label>
                    <label><input type="checkbox" name="discipline" value="environmental" checked> üå± Environmental Conservation</label>
                    <label><input type="checkbox" name="discipline" value="gamification" checked> üéÆ Gamification</label>
                    <label><input type="checkbox" name="discipline" value="vr"> ü•Ω Virtual Reality / XR</label>
                    <label><input type="checkbox" name="discipline" value="visual-media"> üé¨ Visual Media & Design</label>
                    <label><input type="checkbox" name="discipline" value="social-marketing"> üì± Social Media Marketing</label>
                    <label><input type="checkbox" name="discipline" value="climate"> üåç Climate & Sustainability</label>
                    <label><input type="checkbox" name="discipline" value="policy"> üìã Policy & Governance</label>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="scrapeOpportunities()">
                    <i class="fas fa-search"></i> Scrape Now
                </button>
                <button class="btn btn-outline" onclick="clearFilters()">
                    <i class="fas fa-redo"></i> Reset Filters
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="stats" style="display: none;">
            <div class="stat-card">
                <p class="stat-number" id="stat-opportunities">0</p>
                <p class="stat-label">Opportunities Found</p>
            </div>
            <div class="stat-card">
                <p class="stat-number" id="stat-universities">0</p>
                <p class="stat-label">Universities</p>
            </div>
            <div class="stat-card">
                <p class="stat-number" id="stat-funded">0</p>
                <p class="stat-label">Fully Funded</p>
            </div>
            <div class="stat-card">
                <p class="stat-number" id="stat-deadline">0</p>
                <p class="stat-label">Urgent (< 30 days)</p>
            </div>
        </div>

        <!-- Results -->
        <div class="results-container" id="results" style="display: none;">
            <div class="results-header">
                <div class="results-info">
                    <div>
                        <p style="margin: 0; font-size: 0.85rem; opacity: 0.9;">Total Results</p>
                        <div class="results-count" id="resultCount">0</div>
                    </div>
                </div>
                <div class="results-actions">
                    <button class="btn btn-secondary btn-sm" onclick="exportToCSV()">
                        <i class="fas fa-download"></i> CSV
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn btn-outline" onclick="shareResults()" style="background: white; color: var(--primary); border: 2px solid white;">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                </div>
            </div>
            <div class="results-body" id="resultsBody">
                <!-- Results will be inserted here -->
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" style="margin-top: 2rem;">
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <p style="font-size: 1rem; margin-top: 1rem;">Click "Scrape Now" to discover PhD opportunities</p>
                <p style="font-size: 0.9rem;">Searching across FindAPhD, Jobs.ac.uk, and major universities worldwide</p>
            </div>
        </div>
    </div>

    <script>
        // Sample data - In production, this would come from the backend
        const sampleOpportunities = [
            {
                id: 1,
                title: "Gamification for Climate Change Behavior: A Stepped-Wedge RCT",
                organization: "University of Oxford",
                department: "Interdisciplinary Research Unit",
                location: "Oxford, UK",
                deadline: "2026-03-15",
                funding: "Fully Funded",
                description: "Seeking a PhD researcher to design and evaluate gamified interventions for sustainable behavior change. The project combines environmental conservation with behavioral economics and game theory.",
                disciplines: ["behavior-change", "environmental", "gamification"],
                supervisor: "Prof. Sarah Mitchell",
                source: "FindAPhD",
                url: "https://www.findaphd.com/phds/example-phd-1"
            },
            {
                id: 2,
                title: "Virtual Reality for Environmental Education & Policy Engagement",
                organization: "ETH Zurich",
                department: "Chair of Sustainable Systems",
                location: "Zurich, Switzerland",
                deadline: "2026-05-01",
                funding: "Fully Funded",
                description: "We are seeking an innovative PhD student to develop immersive VR experiences that promote climate citizenship and participatory governance in environmental policy-making.",
                disciplines: ["vr", "environmental", "policy"],
                supervisor: "Prof. Klaus Weber",
                source: "Jobs.ac.uk",
                url: "https://www.jobs.ac.uk/example-phd-2"
            },
            {
                id: 3,
                title: "Social Media Campaigns for Wildlife Conservation: A Mixed-Methods Study",
                organization: "University College London",
                department: "Institute for Global Change Science",
                location: "London, UK",
                deadline: "2026-04-30",
                funding: "Fully Funded",
                description: "Join our research team to investigate how social media marketing strategies can drive conservation behavior. The role combines digital media analysis with environmental science.",
                disciplines: ["social-marketing", "environmental"],
                supervisor: "Dr. Emma Thompson",
                source: "FindAPhD",
                url: "https://www.findaphd.com/phds/example-phd-3"
            },
            {
                id: 4,
                title: "Behavioral Design for Sustainable Consumption: Interdisciplinary Approach",
                organization: "Swedish University of Agricultural Sciences",
                department: "Department of Sustainable Systems",
                location: "Uppsala, Sweden",
                deadline: "2026-06-15",
                funding: "Fully Funded",
                description: "This position offers the opportunity to work on an interdisciplinary project combining behavior change theory, visual design, and environmental policy. Focus on sustainable consumption patterns.",
                disciplines: ["behavior-change", "environmental", "visual-media", "policy"],
                supervisor: "Prof. Anders √Öberg",
                source: "University Website",
                url: "https://www.slu.se/example-phd-4"
            },
            {
                id: 5,
                title: "Immersive Media Experiences for Climate Action & Public Engagement",
                organization: "MIT Media Lab",
                department: "Learning Systems",
                location: "Cambridge, USA",
                deadline: "2026-02-28",
                funding: "Fully Funded",
                description: "We seek a creative researcher to design AR/VR/mixed reality experiences that engage publics in climate action. Position involves gamification, visual storytelling, and behavior change.",
                disciplines: ["vr", "visual-media", "climate"],
                supervisor: "Prof. David Thorburn",
                source: "FindAPhD",
                url: "https://www.mit.edu/example-phd-5"
            }
        ];

        let allOpportunities = [];

        async function scrapeOpportunities() {
            const scrapeBtn = event.target;
            scrapeBtn.disabled = true;
            scrapeBtn.innerHTML = '<span class="loading-spinner"></span> Scraping...';

            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Filter by selected disciplines
                const selectedDisciplines = Array.from(document.querySelectorAll('input[name="discipline"]:checked'))
                    .map(el => el.value);

                const filtered = sampleOpportunities.filter(opp => {
                    const hasDiscipline = opp.disciplines.some(d => selectedDisciplines.includes(d));
                    return selectedDisciplines.length === 0 || hasDiscipline;
                });

                allOpportunities = filtered;
                displayResults(filtered);
                updateStats(filtered);

                // Show success message
                showMessage('Successfully scraped ' + filtered.length + ' opportunities!', 'success');

            } catch (error) {
                showMessage('Error scraping opportunities. Please try again.', 'error');
                console.error(error);
            } finally {
                scrapeBtn.disabled = false;
                scrapeBtn.innerHTML = '<i class="fas fa-search"></i> Scrape Now';
            }
        }

        function displayResults(opportunities) {
            const resultsBody = document.getElementById('resultsBody');
            const resultCount = document.getElementById('resultCount');
            const results = document.getElementById('results');
            const emptyState = document.getElementById('emptyState');

            resultCount.textContent = opportunities.length;

            if (opportunities.length === 0) {
                resultsBody.innerHTML = '';
                results.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            results.style.display = 'block';

            resultsBody.innerHTML = opportunities.map(opp => `
                <div class="opportunity-card">
                    <div class="opportunity-header">
                        <div style="flex: 1;">
                            <p class="opportunity-title">${opp.title}</p>
                            <p style="margin: 0.5rem 0 0 0; color: var(--primary); font-weight: 600;">${opp.organization}</p>
                        </div>
                        <div class="opportunity-badges">
                            ${opp.funding === 'Fully Funded' ? '<span class="badge badge-success"><i class="fas fa-check-circle"></i> Funded</span>' : ''}
                            ${getDaysUntilDeadline(opp.deadline) < 30 ? '<span class="badge badge-accent"><i class="fas fa-exclamation-triangle"></i> Urgent</span>' : ''}
                        </div>
                    </div>

                    <div class="opportunity-meta">
                        <div class="meta-item">
                            <i class="fas fa-map-marker-alt"></i> ${opp.location}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-calendar-alt"></i> Deadline: ${formatDate(opp.deadline)}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-user"></i> ${opp.supervisor}
                        </div>
                    </div>

                    <p class="opportunity-description">${opp.description}</p>

                    <div style="margin-bottom: 1rem;">
                        <span style="font-weight: 600; font-size: 0.85rem; color: #666;">Disciplines:</span>
                        <div class="opportunity-badges" style="margin-top: 0.5rem;">
                            ${opp.disciplines.map(d => `<span class="badge badge-primary">${getDisciplineLabel(d)}</span>`).join('')}
                        </div>
                    </div>

                    <div class="opportunity-footer">
                        <a href="${opp.url}" target="_blank" class="opportunity-link">
                            View Full Details <i class="fas fa-external-link-alt"></i>
                        </a>
                        <span style="font-size: 0.85rem; color: #999;">via ${opp.source}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateStats(opportunities) {
            const stats = document.getElementById('stats');
            stats.style.display = 'grid';

            const universities = new Set(opportunities.map(o => o.organization)).size;
            const funded = opportunities.filter(o => o.funding === 'Fully Funded').length;
            const urgent = opportunities.filter(o => getDaysUntilDeadline(o.deadline) < 30).length;

            document.getElementById('stat-opportunities').textContent = opportunities.length;
            document.getElementById('stat-universities').textContent = universities;
            document.getElementById('stat-funded').textContent = funded;
            document.getElementById('stat-deadline').textContent = urgent;
        }

        function exportToCSV() {
            if (allOpportunities.length === 0) {
                alert('No opportunities to export. Please scrape first.');
                return;
            }

            const headers = ['Title', 'Organization', 'Location', 'Deadline', 'Supervisor', 'Disciplines', 'Funding', 'URL'];
            const rows = allOpportunities.map(opp => [
                opp.title,
                opp.organization,
                opp.location,
                opp.deadline,
                opp.supervisor,
                opp.disciplines.map(d => getDisciplineLabel(d)).join('; '),
                opp.funding,
                opp.url
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `phd-opportunities-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            showMessage('CSV exported successfully!', 'success');
        }

        function exportToPDF() {
            if (allOpportunities.length === 0) {
                alert('No opportunities to export. Please scrape first.');
                return;
            }

            const element = document.createElement('div');
            element.innerHTML = `
                <h1>PhD Opportunity Report</h1>
                <p>Generated on: ${new Date().toLocaleDateString()}</p>
                <p>Total Opportunities: ${allOpportunities.length}</p>
                <hr>
                ${allOpportunities.map(opp => `
                    <div style="margin-bottom: 20px; page-break-inside: avoid;">
                        <h2>${opp.title}</h2>
                        <p><strong>Organization:</strong> ${opp.organization}</p>
                        <p><strong>Location:</strong> ${opp.location}</p>
                        <p><strong>Deadline:</strong> ${formatDate(opp.deadline)}</p>
                        <p><strong>Supervisor:</strong> ${opp.supervisor}</p>
                        <p><strong>Funding:</strong> ${opp.funding}</p>
                        <p><strong>Description:</strong> ${opp.description}</p>
                        <p><strong>Disciplines:</strong> ${opp.disciplines.map(d => getDisciplineLabel(d)).join(', ')}</p>
                        <p><a href="${opp.url}">View Full Details</a></p>
                        <hr>
                    </div>
                `).join('')}
            `;

            const opt = {
                margin: 10,
                filename: `phd-opportunities-${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };

            html2pdf().set(opt).from(element).save();
            showMessage('PDF exported successfully!', 'success');
        }

        function shareResults() {
            const text = `Check out these ${allOpportunities.length} interdisciplinary PhD opportunities I found! Behavior change, environmental conservation, gamification, VR & more. https://yoursite.com/phd-finder`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'PhD Opportunity Finder',
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(text);
                showMessage('Share link copied to clipboard!', 'success');
            }
        }

        function clearFilters() {
            document.getElementById('location').value = 'global';
            document.getElementById('funding').value = 'fully-funded';
            document.getElementById('deadline').value = '12';
            document.querySelectorAll('input[name="discipline"]').forEach(el => {
                el.checked = ['behavior-change', 'environmental', 'gamification'].includes(el.value);
            });
            
            allOpportunities = [];
            document.getElementById('results').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
        }

        function showMessage(text, type) {
            const message = document.createElement('div');
            message.className = type === 'success' ? 'success-message' : 'error-message';
            message.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${text}`;
            
            document.querySelector('.container').insertBefore(message, document.querySelector('.filters-panel'));
            
            setTimeout(() => message.remove(), 4000);
        }

        function getDaysUntilDeadline(deadline) {
            const today = new Date();
            const deadlineDate = new Date(deadline);
            const diff = Math.ceil((deadlineDate - today) / (1000 * 60 * 60 * 24));
            return diff;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function getDisciplineLabel(discipline) {
            const labels = {
                'behavior-change': 'üß† Behavior Change',
                'environmental': 'üå± Environmental',
                'gamification': 'üéÆ Gamification',
                'vr': 'ü•Ω VR/XR',
                'visual-media': 'üé¨ Visual Media',
                'social-marketing': 'üì± Social Marketing',
                'climate': 'üåç Climate',
                'policy': 'üìã Policy'
            };
            return labels[discipline] || discipline;
        }
    </script>
</body>
</html>